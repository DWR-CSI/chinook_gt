{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://raw.githubusercontent.com/DWR-CSI/Chinook_gt/master/nextflow_schema.json",
    "title": "Chinook pipeline parameters",
    "description": "Schema for the Full GT pipeline parameters",
    "type": "object",
    "$defs": {
        "input_options": {
            "title": "Input Options",
            "type": "object",
            "description": "Define where the pipeline should find input data.",
            "properties": {
                "project": {
                    "type": "string",
                    "description": "Give a name to this project or run. No spaces or special characters. This is also used as the output subdirectory name in the results folder.",
                    "default": "YourProject1",
                    "pattern": "^[A-Za-z0-9_-]+$"
                },
                "input": {
                    "type": "string",
                    "description": "Path to input FastQ files (must be paired-end)",
                    "default": "az://seqera1/raw_data/ADPH_mushed/*_R{1,2}_concatenated.fastq.gz",
                    "format": "path"
                }
            }
        },
        "trimmomatic_options": {
            "title": "Trimmomatic Options",
            "type": "object",
            "description": "Options for adapter trimming with Trimmomatic.",
            "properties": {
                "trim_params": {
                    "type": "string",
                    "description": "Trimmomatic trimming parameters",
                    "default": "LEADING:15 TRAILING:15 SLIDINGWINDOW:4:15 MINLEN:36"
                }
            }
        },
        "flash_options": {
            "title": "FLASH2 Options",
            "type": "object",
            "description": "Options for merging paired reads with FLASH2.",
            "properties": {
                "min_overlap": {
                    "type": "integer",
                    "description": "Minimum overlap length for read merging",
                    "default": 3,
                    "minimum": 1
                },
                "max_overlap": {
                    "type": "integer",
                    "description": "Maximum overlap length for read merging",
                    "default": 400,
                    "minimum": 1
                }
            }
        },
        "processing_options": {
            "title": "Processing Options",
            "type": "object",
            "description": "Options for read processing and data handling.",
            "properties": {
                "concat_all_reads": {
                    "type": "boolean",
                    "description": "Concatenate all available reads per sample (merged, unmerged, and unpaired) for BWA mapping. If false, uses only merged and single-end reads (original behavior).",
                    "default": false
                },
                "loci_to_remove": {
                    "type": "string",
                    "description": "Perl-compatible regular expression to match loci column names to remove from analysis. Leave empty to remove no loci. Cannot contain single quotes.",
                    "default": "(NC_037130\\.1:1062935[.-]1063235)|(NC_037130\\.1:864908[.-]865208)|(NC_037104\\.1:56552952[.-]56553042)"
                }
            }
        },
        "threshold_options": {
            "title": "Threshold Options",
            "type": "object",
            "description": "Options for threshold values used in genotype analysis.",
            "properties": {
                "ots28_missing_threshold": {
                    "type": "number",
                    "description": "OTS28 missing data threshold (default: 0.7). If less than this proportion of OTS28 data is missing, consider OTS28 data Intermediate instead of uncertain.",
                    "default": 0.7,
                    "minimum": 0,
                    "maximum": 1
                },
                "gsi_missing_threshold": {
                    "type": "number",
                    "description": "GSI missing data threshold. If more than this proportion of GSI data is missing, consider GSI data invalid.",
                    "default": 0.6,
                    "minimum": 0,
                    "maximum": 1
                },
                "pofz_threshold": {
                    "type": "number",
                    "description": "PofZ ambiguity threshold. If the maximum Probability of Z-score (PofZ) is less than this value, consider the result ambiguous.",
                    "default": 0.8,
                    "minimum": 0,
                    "maximum": 1
                }
            }
        },
        "sexid_threshold_options": {
            "title": "Sex ID Threshold Options",
            "type": "object",
            "description": "Options for threshold values used in sex identification.",
            "properties": {
                "male_sexid_threshold": {
                    "type": "number",
                    "description": "Minimum proportion of reads mapped to the Y chromosome (sdy_I183 locus) to classify a sample as male",
                    "default": 0.02,
                    "minimum": 0,
                    "maximum": 1
                },
                "female_sexid_threshold": {
                    "type": "number",
                    "description": "Maximum proportion of reads mapped to the Y chromosome (sdy_I183 locus) to classify a sample as female",
                    "default": 0.002,
                    "minimum": 0,
                    "maximum": 1
                },
                "sexid_min_reads": {
                    "type": "number",
                    "description": "Minimum number of reads required to confidently assign a sex ID.",
                    "default": 10000,
                    "minimum": 0
                }
            }
        },
        "microhaplotopia_options": {
            "title": "Microhaplotopia Options",
            "type": "object",
            "description": "Microhaplotopia filtering options",
            "properties": {
                "haplotype_depth": {
                    "type": "integer",
                    "description": "Haplotype depth filter: remove haplotypes with less than depth specified here",
                    "help": "This is for removing potential genotyping errors or alleles with depths you don't feel confident about.",
                    "default": 4
                },
                "total_depth": {
                    "type": "integer",
                    "description": "Minimum number of reads required for the genotype to be retained",
                    "default": 8
                },
                "allele_balance": {
                    "type": "number",
                    "description": "Minimum allele balance required for the genotype to be retained.",
                    "help": "Ratio of the number of reads for a given microhaplotype divided by the number of reads of the most common microhaplotype for that individual at that locus. For example, if you have a heterozygote with 60 reads for the haplotype AA and 100 reads for the haplotype TC, the allele balance for the haplotype AA for that individual at that locus is 0.6 and is 1.0 for TC.",
                    "default": 0.35,
                    "minimum": 0,
                    "maximum": 1
                }
            }
    },
        "ckmr_options": {
            "title": "CKMRsim Options",
            "type": "object",
            "description": "CKMRsim for parent-offspring analysis using close-kin mark-recapture methods.",
            "properties": {
                "use_CKMR": {
                    "type": "boolean",
                    "description": "Enable CKMRsim for parent-offspring analysis. If false, the pipeline will not run CKMRsim.",
                    "default": false
                },
                "CKMR_parent_geno_input": {
                    "type": "string",
                    "description": "Path to parent genotype file (CKMRsim formatted).",
                    "default": "az://seqera1/reference/full_panel/PBT/FRH2024_reference_genotypes.csv",
                    "format": "path"
                },
                "CKMR_logl_threshold": {
                    "type": "number",
                    "description": "Log-likelihood ratio threshold for filtering for parent-offspring relationships. Higher values are more conservative.",
                    "default": 6.9,
                    "minimum": 0
                },
                "CKMR_min_loci": {
                    "type": "integer",
                    "description": "Minimum number of loci required for valid parent-offspring assignment.",
                    "default": 90,
                    "minimum": 1
                },
                "CKMR_extra_genos_allele_freqs": {
                    "type": "string",
                    "description": "Path to extra genotypes file (wide format CSV) for additional individuals to include in allele frequency calculations.",
                    "default": "az://seqera1/reference/full_panel/PBT/JPE2022-2024_geno_wide.csv",
                    "format": "path"
                }
            }
        },
        "sequoia_options": {
            "title": "Sequoia Options",
            "type": "object",
            "description": "Sequoia for parentage-based tagging (PBT) analysis.",
            "properties": {
                "use_sequoia": {
                    "type": "boolean",
                    "description": "Enable Sequoia for PBT analysis. If false, the pipeline will not run Sequoia.",
                    "default": false
                },
                "sequoia_mode": {
                    "type": "string",
                    "description": "Sequoia mode for PBT analysis. Options are 'par' for parentage analysis or 'ped' for full pedigree analysis (takes much longer).",
                    "default": "par",
                    "enum": ["par", "ped"]
                },
                "sequoia_missing_threshold": {
                    "type": "number",
                    "description": "Sequoia missing data threshold. If more than this proportion of data is missing, consider the result invalid. Set to 0.2 for conservative cut-off.",
                    "default": 0.5,
                    "minimum": 0,
                    "maximum": 1
                },
                "parent_geno_input": {
                    "type": "string",
                    "description": "Path to parent genotype file (Sequoia formatted).",
                    "default": "az://seqera1/reference/full_panel/PBT/FRH2024_reference_genotypes.csv",
                    "format": "path"
                },
                "parent_lifehistory": {
                    "type": "string",
                    "description": "Path to parent metadata (lifehistory) file (Sequoia formatted).",
                    "default": "az://seqera1/reference/full_panel/PBT/FRH2024_reference_lifehistory.txt",
                    "format": "path"
                },
                "offspring_birthyear": {
                    "type": "string",
                    "description": "Birth year of the offspring for Sequoia analysis.",
                    "default": "unknown"
                },
                "offspring_minBY": {
                    "type": "string",
                    "description": "Minimum birth year for offspring in Sequoia analysis.",
                    "default": "unknown"
                },
                "offspring_maxBY": {
                    "type": "string",
                    "description": "Maximum birth year for offspring in Sequoia analysis. If unknown, set to current year.",
                    "default": "2025"
                },
                "offspring_max_age": {
                    "type": "integer",
                    "description": "Maximum age of the offspring in the dataset.",
                    "default": 1,
                    "minimum": 0
                },
                "species_max_repro_age": {
                    "type": "integer",
                    "description": "Maximum reproductive age of the species in the dataset.",
                    "default": 6,
                    "minimum": 0
                },
                "species_min_repro_age": {
                    "type": "integer",
                    "description": "Minimum reproductive age of the species in the dataset.",
                    "default": 1,
                    "minimum": 0
                }
            }
        }
    },
    "allOf": [
        {
            "$ref": "#/$defs/input_options"
        },
        {
            "$ref": "#/$defs/trimmomatic_options"
        },
        {
            "$ref": "#/$defs/flash_options"
        },
        {
            "$ref": "#/$defs/processing_options"
        },
        {
            "$ref": "#/$defs/sexid_threshold_options"
        },
        {
            "$ref": "#/$defs/microhaplotopia_options"
        },
        {
            "$ref": "#/$defs/threshold_options"
        },
        {
            "$ref": "#/$defs/ckmr_options"
        },
        {
            "$ref": "#/$defs/sequoia_options"
        }
    ]
}
